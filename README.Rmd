---
title: "Epibuffet"
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://www.tidyverse.org/lifecycle/#experimental)
[![CRAN status](https://www.r-pkg.org/badges/version/epibuffet)](https://CRAN.R-project.org/package=epibuffet)
[![Travis build status](https://travis-ci.org/R4EPI/epibuffet.svg?branch=master)](https://travis-ci.org/R4EPI/epibuffet)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/zkamvar/epibuffet?branch=master&svg=true)](https://ci.appveyor.com/project/zkamvar/epibuffet)
[![Codecov test coverage](https://codecov.io/gh/R4EPI/epibuffet/branch/master/graph/badge.svg)](https://codecov.io/gh/R4EPI/epibuffet?branch=master)
<!-- badges: end -->

The {epibuffet} package produces tables for descriptive epidemiological analysis.
It contains three functions:

 - `tab_linelist()` --- Tabulate and describe counts of variables in a linelist
 - `tab_survey()` --- Tabulate and describe counts of variables in a survey (with appropriate CIs)
 - `tab_univariate()` --- Calculate Odds / Risk / Incidence Rate Ratios directly from a linelist

## Installation

{epibuffet} is currently under development, but you can keep up-to-date by
installing it from the R4EPIs drat repository:

```{r eval = FALSE}
# install.packages("drat")
drat::addRepo("R4EPI")
install.packages("epibuffet")
```

You can also install the in-development version from GitHub using the {remotes}
package (but there's no guarantee that it will be stable):

```{r eval = FALSE}
# install.packages("remotes")
remotes::install_github("R4EPI/epibuffet") 
```

</details>
## Example

Here is an example of the tables produced by {epibuffet} from a randomly
generated data set based on an MSF data dictionary for Measles data. 

```{r example}
library(msfdict)
library(matchmaker)
library(epikit)
library(dplyr)
library(epibuffet)

linelist <- msfdict::gen_data("Measles", numcases = 1000)
measles_dict <- msfdict::msf_dict("Measles", compact = FALSE)

# Cleaning linelist data
linelist_clean <- matchmaker::match_df(
  x = linelist,
  dictionary = measles_dict,
  from = "option_code",
  to = "option_name",
  by = "data_element_shortname",
  order = "option_order_in_set"
)
linelist_clean
```

## Quick tabulations

```{r tab_linelist}
the_symptoms <- tab_linelist(linelist_clean,
  cough, nasal_discharge, severe_oral_lesions,
  transpose = "value"
) 
the_symptoms
```

```{r print_linelist}
the_symptoms %>%
  epikit::rename_redundant("%" = "proportion") %>%
  epikit::augment_redundant("(n)" = "n") %>%
  knitr::kable()
```

## Odds / Risk / Incidence Rate Ratios

```{r orrr}
symptoms_tf <- linelist_clean %>%
  dplyr::transmute(
    pneumonia = grepl("Yes", pneumonia),
    cough = grepl("Yes", cough),
    nasal_discharge = grepl("Yes", nasal_discharge),
    oral_lesions = grepl("Yes", severe_oral_lesions),
    contact = grepl("known case", contact_history)
  ) 

symptoms_tf

tu <- tab_univariate(symptoms_tf, 
  outcome = pneumonia, 
  cough, nasal_discharge, oral_lesions, contact,
  mergeCI = TRUE,
  extend_output = FALSE
)
tu %>% select(-est_type) %>% knitr::kable(digits = 3)
```

